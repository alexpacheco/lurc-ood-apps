<%
  if /cent7/ =~ opsys
    image="/share/Apps/virtualapps/centos7/xfce7.sif"
  elsif /alma/ =~ opsys
    image="/home/alp514/alma.sif"
  elsif /rocky/ =~ opsys
    image="/home/alp514/rocky.sif"
  else
    image="/home/alp514/xfce8.sif"
#    image="/share/Apps/virtualapps/centos8/xfce8.sif"
  end
%>
---
batch_connect:
  template: vnc
  set_host: "host=$(hostname)"
  websockify_cmd: '/opt/websockify/run'
  script_wrapper: |
    export XDG_RUNTIME_DIR=""
    cat << "CTRSCRIPT" > container.sh
    export PATH="$PATH:/opt/TurboVNC/bin"
    %s
    CTRSCRIPT

    # your bindpath will differ
    export SINGULARITY_BINDPATH="$HOME,/share,/run"
    #
    #singularity run /share/Apps/virtualapps/centos7/mate.sif
    singularity exec <%= image %>  /bin/bash container.sh    
script:
  queue_name: <%= custom_queue %>
  native:
    - "--nodes"
    - "<%= bc_num_slots.blank? ? 1 : bc_num_slots.to_i %>"
    - "--ntasks"
    - "<%= num_cpus.blank? ? 1 : num_cpus.to_i %>"
    <%- if num_gpus.to_i > "0" -%>
    - "--gres=gpu:<%= num_gpus.to_i %>"
    <%- end -%>
