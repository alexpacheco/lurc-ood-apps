<%
  result = %x[id]
%>
---
cluster: "sol"
description: |
  This app will launch STATA on one Sol cpu. You will be
  able to interact with STATA through a VNC session.
attributes:
  desktop: xfce
  bc_num_slots: "1"
  bc_num_hours:
    label: "Number of hours"
    value: 1   
    min: 1
    max: 72
    help: "Maximum walltime is limited to 1 hour"
  bc_account:
    label: "Account"
    help: "Leave blank if using your default allocation."
    value: "lts"
  num_cores: 
    label: "Number of cores"
    value: 1
    min: 1
    max: 52
    help: "Each Stata/MP simulation can use upto 4 cpus.  
    Request more cpus if you need more memory than provided by the partition per core.
    For example: On LTS partition, if your 4 core STATA job requires 40GB memory, then request 7 cpus."
  custom_queue:
    label: "Partition"
    help: "Please select a partition from the drop-down."
    widget: select
    options:
      - [ "debug partition, 16 cores, 1 hour, 3.5GB/core", "debug" ]
      - [ "lts partition, 18 cores, 72 hours, 6GB/core", "lts" ]
      - [ "eng partition, 22 cores, 72 hours, 5GB/core", "eng" ]
      - [ "engc partition, 24 cores, 72 hours, 2.5GB/core", "engc" ]
      - [ "enge partition, 36 cores, 72 hours, 5GB/cores", "enge" ]
      - [ "engi partition, 36 cores, 72 hours, 5GB/cores", "engi" ]
      - [ "im1080 partition, 20 cores, 48 hours, 5GB/core", "im1080" ]
      - [ "im2080 partition, 28 cores, 48 hours, 5GB/core", "im2080" ]
      - [ "chem partition, 36 cores, 48 hours, 5GB/core", "chem" ]
      - [ "health partition, 36 cores, 48 hours, 5GB/core", "health" ]
      - [ "hawkcpu partition, 52 cores, 48 hours, 7.4GB/core", "hawkcpu" ]
      - [ "infolab partition, 52 cores, 48 hours, 7.4GB/core", "infolab" ]
      <% if /himem/ =~ result  %>
      - [ "himem-long, 16 cores, 168 hours, 32GB/core", "himem-long"]
      <% end %>
      <% if /HPCSOFT/ =~ result  %>
      - [ "himem-long, 16 cores, 168 hours, 32GB/core", "himem-long"]
      - [ "singularity test", "singularity-test"]
      - [ "virtual desktop", "vdi-test"]
      <% end %>
  version:
    widget: select
    label: "STATA version"
    help: "This defines the version of STATA you want to load.
           STATA 15 opens the parallel executable while STATA 17 opens the serial executable."
    options:
      - [ "15", "15"]
      - [ "17", "17"]
  opsys:
    widget: select
    label: "Choose the OS to load."
    help: "CentOS 8 does not display icons on the STATA 15 app. Use CentOS 7 if you want the icons to show. Other applications may not work correctly in CentOS 7"
    options:
      - [ "CentOS 8", "centos8/xfce8"]
      - [ "CentOS 7", "centos7/xfce"]
form:
  - version
  - opsys
  - desktop
  - bc_account
  - bc_num_hours
  - bc_num_slots
  - num_cores
  - custom_queue
  - bc_email_on_started
  


